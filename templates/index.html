<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Task List</title>
    <script defer src="{{ url_for('static', filename='tasks.js') }}"></script>
</head>
<body 
    {% if reopen_id %}
        data-reopen-id="{{ reopen_id }}"
        data-edit-title="{{ form_data.title if form_data else '' }}"
        data-edit-priority="{{ form_data.priority if form_data else '' }}"
        data-edit-due-date="{{ form_data.due_date if form_data else '' }}"
        data-edit-done="{{ form_data.done if form_data else '0' }}"
    {% endif %}
>
    <h1 id="main-header">My Tasks</h1>

    {% if error %}
        <p style="color: red; font-weight: bold;">{{ error }}</p>
    {% endif %}

    <!-- Add Task Form -->
    <form method="POST" action="/tasks" id="add-form">
        <input type="text" name="title" placeholder="Task title" required
               value="{{ form_data.title if form_data else '' }}" />

        <select name="priority" required>
            <option value="">Priority</option>
            <option value="low" {% if form_data and form_data.priority == 'low' %}selected{% endif %}>Low</option>
            <option value="medium" {% if form_data and form_data.priority == 'medium' %}selected{% endif %}>Medium</option>
            <option value="high" {% if form_data and form_data.priority == 'high' %}selected{% endif %}>High</option>
        </select>

        <label for="due_date">Due Date:</label>
        <input type="datetime-local" name="due_date"
               value="{{ form_data.due_date if form_data else '' }}" />

        <button type="submit">Add Task</button>
    </form>

    <!-- Task List -->
    <ul id="task-list">
        {% for task in tasks %}
            <li>
                <strong>{{ task[1] }}</strong> —
                Priority: {{ task[3] or 'None' }} —
                Created: {{ task[5] }} —
                {% if task[4] %}
                    Due: {{ task[4]|datetimeformat }} —
                {% else %}
                    Due: <em>None</em> —
                {% endif %}
                {% if task[2] %}
                    <em>(Done)</em>
                {% else %}
                    <em>(Pending)</em>
                {% endif %}

                <!-- Edit Button -->
                <button
                    class="edit-btn"
                    data-task-id="{{ task[0] }}"
                    data-title="{{ task[1] }}"
                    data-done="{{ 1 if task[2] else 0 }}"
                    data-priority="{{ task[3] }}"
                    data-due-date="{{ task[4] or '' }}"
                >Edit</button>

                <!-- Delete Form -->
                <form method="POST" action="/delete/{{ task[0] }}" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this task?');">
                        Delete
                    </button>
                </form>
            </li>
        {% else %}
            <li>No tasks yet!</li>
        {% endfor %}
    </ul>

    <!-- Edit Form -->
    <div id="edit-wrapper" style="display:none;">
        <form method="POST" id="edit-form">
            <label for="edit-title">Title:</label>
            <input type="text" name="title" id="edit-title" required />

            <label for="edit-priority">Priority:</label>
            <select name="priority" id="edit-priority" required>
                <option value="">Priority</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>

            <label for="edit-due-date">Due Date:</label>
            <input type="datetime-local" name="due_date" id="edit-due-date" />

            <label for="edit-done">
                <input type="checkbox" name="done" id="edit-done" /> Done
            </label>

            <button type="submit">Save</button>
            <button type="button" id="cancel-edit">Cancel</button>
        </form>
    </div>
</body>
</html>